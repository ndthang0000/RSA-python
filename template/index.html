<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
            //check login
        let isLogin=JSON.parse(localStorage.getItem('isLogin'))
        if(!isLogin){
            window.location.href=window.location.pathname.replace('index','login')
        }
    </script>
    <title>The One - abum</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="./assets/css/style.css">
    <link rel="shortcut icon" href="assets/image/favicon.ico" type="image/x-icon">
        <style type="text/css">
        @keyframes ldio-cwqafa4ih5e-r {
          0%, 100% { animation-timing-function: cubic-bezier(0.2 0 0.8 0.8) }
          50% { animation-timing-function: cubic-bezier(0.2 0.2 0.8 1) }
          0% { transform: rotate(0deg) }
          50% { transform: rotate(180deg) }
          100% { transform: rotate(360deg) }
        }
        @keyframes ldio-cwqafa4ih5e-s {
          0%, 100% { animation-timing-function: cubic-bezier(0.2 0 0.8 0.8) }
          50% { animation-timing-function: cubic-bezier(0.2 0.2 0.8 1) }
          0% { transform: translate(-44px,-44px) scale(0) }
          50% { transform: translate(-44px,-44px) scale(1) }
          100% { transform: translate(-44px,-44px) scale(0) }
        }
        .ldio-cwqafa4ih5e > div { transform: translate(0px,-22px) }
        .ldio-cwqafa4ih5e > div > div {
          animation: ldio-cwqafa4ih5e-r 0.78125s linear infinite;
          transform-origin: 100px 100px;
        }
        .ldio-cwqafa4ih5e > div > div > div {
          position: absolute;
          transform: translate(100px, 73.6px);
        }
        .ldio-cwqafa4ih5e > div > div > div > div {
          width: 88px;
          height: 88px;
          border-radius: 50%;
          background: #fe718d;
          animation: ldio-cwqafa4ih5e-s 0.78125s linear infinite;
        }
        .ldio-cwqafa4ih5e > div > div:last-child {
          animation-delay: -0.390625s;
        }
        .ldio-cwqafa4ih5e > div > div:last-child > div > div {
          animation-delay: -0.390625s;
          background: #46dff0;
        }
        .loadingio-spinner-interwind-bdbqx359n3n {
          width: 200px;
          height: 200px;
          display: inline-block;
          overflow: hidden;
          background: #ffffff;
        }
        .ldio-cwqafa4ih5e {
          width: 100%;
          height: 100%;
          position: relative;
          transform: translateZ(0) scale(1);
          backface-visibility: hidden;
          transform-origin: 0 0; /* see note above */
        }
        .ldio-cwqafa4ih5e div { box-sizing: content-box; }
        /* generated by https://loading.io/ */
        </style>
</head>
<body>
    <div id="bg-black-item" style="position: absolute;top: 0;left: 0;width: 100%;height: 100%;background: rgba(0,0,0,0.4);z-index: 9;"></div>
    <div class="loadingio-spinner-interwind-bdbqx359n3n" 
    style="position: absolute;top: 50%;left: 50%;z-index: 10;border-radius: 50%;transform: translate(-50%,-50%);">
        <div class="ldio-cwqafa4ih5e">
        <div><div><div><div></div></div></div><div><div><div></div></div></div></div>
        </div></div>
    <div class="bg-image">
        <!-- header -->
        <header class="header bg-white" style="box-shadow: -1px 7px 14px 4px rgba(101,101,101,0.40);">
            <div class="container" style="align-items: center;">
                <div class="row">
<<<<<<< HEAD
                    <div class="col-4 header-logo">THE ONE</div>
                    <div class="col-8">
                        <div class="dropdown float-end mt-3 mb-2">
                            <a class="btn btn-success dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-person-circle"></i>
                              username
                            </a>
                          
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                              <li><div id="log-out" class="dropdown-item" >Đăng xuất</div></li>
                            </ul>
                          </div>
=======
                    <div class="col-3 header-logo" style="color: #555;">
                        <img src="./assets//image/icon.png" width="50px" alt="">
                        <span class="name">
                            THE ONE
                        </span>
                    </div>
                    <div class="col-6 menu-list">
                        <li ><a href="./index.html" >Xem abum ảnh</a></li>
                        <li> <a href="./upload.html">Tải ảnh lên</a> </li>
                    </div>
                    <div class="col-3 image-area-avatar">
                        <div class="image-area">
                            <img src="./assets/image/avatar.png" width="100%"  alt="" class="img-avatar">
                        </div>
                        <div class="list-item ds-none-block">
                            <li><a href="./login.html" id="log-out">Đăng xuất</a></li>
                        </div>
>>>>>>> fc22f783e6bf04091285ac1d7a73d03f99cdd8eb
                    </div>
                </div>
            </div>
        </header>
        <div class="side-bar-menu">
            <div>
                <li style="font-size: 20px;padding: 5px 10px;margin: 5px;"><a href="./index.html" >Xem abum ảnh</a></li>
                <li style="font-size: 20px;padding: 5px 10px;margin: 5px;"> <a href="./upload.html">Tải ảnh lên</a> </li>
            </div>
        </div>
        <!-- content -->
        <div class="content">
            <div class="container bg-light" style="min-height: 1000px;padding: 50px; border-radius: 10px;margin-top: 100px;position: relative;">
                <div class="abum">
                    <div class=" title-content text-center" >
                        <i class="bi bi-image" style="color: #1e90ff;"></i>
                        Abum ảnh của bạn
                    </div>
                </div>
                <div style="margin-top: 50px;padding: 20px;">
                    <button type="button" class="btn btn-success">
                        <i class="bi bi-download"></i>
                        Tải xuống tất cả các ảnh
                    </button>
                    <button type="button" class="btn btn-nomarl">
                        <i class="bi bi-file-arrow-down"></i>
                        Tải xuống ảnh đã chọn
                    </button>
                </div>
                <div class="row image-list ms-2" style="margin-top: 50px;">
                    
                    
                </div>
            </div>
        </div>
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <input type="text" placeholder="username.." style="padding: 4px 8px;border-radius: 5px;border: 1px solid #888;outline: none;">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary">Save changes</button>
                    </div>
                </div>
            </div>
            </div>
        </div>
        <!-- footer -->
        <footer class="footer mt-1 bg-dark">
            <div class="container ">
                <div class="text-center text-white row">
                    <div class="mt-3">
                        <p class="text-footer"><i class="bi bi-boxes"></i> Đồ án được thực hiện bởi nhóm THE ONE </p>
                    </div>
                </div>
            </div>
        </footer>
        <div id="canvas"></div>
    </div>
<<<<<<< HEAD
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
     integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

     <script>
         
         document.addEventListener("DOMContentLoaded",(e)=>{
             let isLogin=JSON.parse(localStorage.getItem('isLogin'))
             console.log(typeof isLogin)
             if(!isLogin){
                    window.location.href=window.location.pathname.replace('index','login')
                }
         })

         let btnLogOut=document.querySelector('#log-out')
         console.log(btnLogOut)
         btnLogOut.addEventListener('click', (e)=>{
             localStorage.setItem('isLogin', JSON.stringify(false))
             window.location.href=window.location.pathname.replace('index','login')
         })
     </script>
=======
    <script src="https://peterolson.github.io/BigInteger.js/BigInteger.min.js"></script>
    <script src="./assets/js/RSA.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js" integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js" integrity="sha512-E8QSvWZ0eCLGk4km3hxSsNmGWbLtSCSUcewDQPQWZF6pEU8GlT8a5fF32wOl1i8ftdMhssTrF/OhyGWwonTcXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="./assets/js/main.js">
        
    </script>
    <script>

    document.addEventListener('DOMContentLoaded',()=>{

        
        let liseImage=document.querySelector('.image-list')
        let canvasEl=document.querySelector('#canvas')
        let token=localStorage.getItem('token')
        fetch('http://localhost:5000/api/my-image',{
            headers: {
                'Authorization': `Bearer ${token}`,
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            method: "GET",
        })
        .then(res=>res.json())
        .then(res=>{
            
            let canvasHtml=''
            for(let i=0;i<res.length;i++){
                canvasHtml+=`<canvas class="canvas" style="display:none"></canvas>`
            }
            canvasEl.innerHTML=canvasHtml
            let allCanvas=document.querySelectorAll('.canvas')
            for(let i=0;i<res.length;i++){
                allCanvas[i].height=res[i].height
                allCanvas[i].width=res[i].width
                let ctx=allCanvas[i].getContext('2d')
                ctx.fillStyle = "red";
                ctx.fillRect(0, 0, res[i].width, res[i].height);
                var imgData = ctx.getImageData(0, 0, res[i].width, res[i].height);

                var bytes  = CryptoJS.AES.decrypt(res[i].ciphertext, 'secret key 123');
                var originalText = bytes.toString(CryptoJS.enc.Utf8);
                let arrIamgeEncrypt=canvasStringToArr(originalText)
                for(let j=0;j<imgData.data.length;j+=4){
                    imgData.data[j]=arrIamgeEncrypt[j]
                    imgData.data[j+1]=arrIamgeEncrypt[j+1]
                    imgData.data[j+2]=arrIamgeEncrypt[j+2]
                    imgData.data[j+3]=255
                }
                ctx.putImageData(imgData, 0, 0);
                var url = allCanvas[i].toDataURL();
                res[i].src=url
            }
            let html=res.map(item=>{
                return `<div class="col-lg-3 col-md-4 col-sm-6" style="margin-bottom:15px">
                            <div class="card" style="width: 100%;">
                                <img src="${item.src}" class="card-img-top" alt="..." style="width:100%;height:auto">
                                <div class="card-body">
                                    <h5 class="card-title">${item.name}</h5>
                                    <p class="card-text" style="color: #888;">Ngày đăng: ${moment(item.createdAt.$date).format('lll')}</p>
                                    <a href="${item.src}" download="" class="btn btn-primary"> 
                                        <i class="bi bi-box-arrow-in-down" style="margin-right: 5px;"></i>
                                        Tải xuống</a>
                                </div>
                                <i class="bi bi-share-fill" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-username="1" data-bs-imageid="${item._id}" ></i>
                            </div>
                        </div>`
            }).join(' ')
            liseImage.innerHTML=html
            document.querySelector('.loadingio-spinner-interwind-bdbqx359n3n').style.display='none'
            document.querySelector('#bg-black-item').style.display='none'

            
        })
        var exampleModal = document.getElementById('exampleModal')
        exampleModal.addEventListener('show.bs.modal', function (event) {
            console.log('sdf')
            var button = event.relatedTarget
            var recipient = button.getAttribute('data-bs-username')
            console.log(recipient)
        })
    })
    

// Decrypt
// var bytes  = CryptoJS.AES.decrypt(ciphertext, 'secret key 123');
// var originalText = bytes.toString(CryptoJS.enc.Utf8);

// console.log(originalText); // 'my message'
    </script>
>>>>>>> fc22f783e6bf04091285ac1d7a73d03f99cdd8eb
</body>
</html>