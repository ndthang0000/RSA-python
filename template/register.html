<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link rel="stylesheet" href="./assets/css/login.css">
    <title>Document</title>
</head>

<body >
    <div class=" login-container">
        <div class=" login-form">
            <h3 style="padding-bottom:20px;">Register</h3>
            <div class="form-group">
                <input type="text" name="full-name" class="form-control" placeholder="Your name *" value="" />
            </div>
            <div class="form-group">
                <input type="text" name="username" class="form-control" placeholder="Your username *" value="" />

            </div>
            <div class="form-group">
                <input type="password" name="password" class="form-control" placeholder="Your password *" value="" />
            </div>
            <div class="form-group">
                <input type="password" name="check-password" class="form-control" placeholder="Confirm your password *" value="" />
            </div>
            <p id="print-error"></p>
            <div class="form-group">
                <div class="btnSubmit" id="submit-btn" >Register!</div>
            </div>   
            <div class="spinner-border" role="status" style="display: none; ">
                <span class="visually-hidden" >Loading...</span>
            </div>
            
        </div>
    </div>
    
    
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script>
        let usernameEl=document.querySelector('input[name="username"]');
        let nameEl=document.querySelector('input[name="full-name"]')
        let passwordEl=document.querySelector('input[name="password"]');
        let checkPasswordEl=document.querySelector('input[name="check-password"]');
        let btnRegister=document.querySelector('#submit-btn')
        let loading=document.querySelector('.spinner-border')
        var i=""
        console.log(loading)
        btnRegister.addEventListener('click',(e)=>{
            if(nameEl.value=='')
            {
                i+="Please enter your name!";
            }

            else if(usernameEl.value.match(/^\s+$/) != null)
            {
                i+="Username cannot contain spaces!";
            }

            else if(usernameEl.value=='')
            {
                i+="Please enter your username!";
            }

            else if(passwordEl.value!=checkPasswordEl.value)
            {
                i+="Password incorrect!!!";

            }

            else if(passwordEl.value==''){
                i+="Please enter your password!";
            }
            
            else if(passwordEl.value.match(/^\s+$/) != null)
            {
                i+="Password cannot contain spaces!";
            }
            else{
                loading.style.display="block";

                fetch('http://localhost:5000/api/register',{
                headers: {
                    'Accept': 'application/json',
                    'Content-Type':'application/json'
                },
                method:'POST',
                body:JSON.stringify({
                    username:usernameEl.value,
                    password:passwordEl.value,
                    name:nameEl.value
                })
            })
            .then(res=>res.json())
            .then(res=>{
                loading.style.display="none";
                console.log(res)
                if(res.success){
                    let isRegister = true;
                    localStorage.setItem('isRegister',JSON.stringify(isRegister))
                    Toastify({
                        text: "Register succesful!!",
                        duration: 2000,
                        newWindow: true,
                        close: true,
                        gravity: "top", // `top` or `bottom`
                        position: "center", // `left`, `center` or `right`
                        stopOnFocus: true, // Prevents dismissing of toast on hover
                        style: {
                            background: "linear-gradient(to right, #00b09b, #96c93d)",
                        }
                        
                    }).showToast();
                    setTimeout(()=>{window.location.href=window.location.pathname.replace('register','index')},2000)
                    
                }
                else{
                    i+="Username invalid!!!";
                }
            })
            }
            document.getElementById('print-error').innerHTML=i ;
            setTimeout(()=>{
                i='';
            },0)
            setTimeout(()=>{document.getElementById('print-error').innerHTML=''},5000)
        })
        
    </script>
</body>
</html>